<!doctype html>
<html class="no-js" lang="en-us">
<head>
  <meta charset="utf-8">
  <title>Climate Widget Demo</title>
  <link rel="stylesheet" href="vendor/skeleton.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
  <style>
    h1 {
      font-size: 3.95rem;
    }

    #widget {
      margin-top: 5px;
      height: 400px;
      width: 600px;
    }
    #download-panel {
      position: absolute;
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
      background-color: rgba(255,255,255,0.8);
    }
    .hidden {
      display: none;
    }
    #download-panel .download-inner {
      margin: auto;
      position: relative;
      top: 70px;
      width: 700px;
      border: 2px solid black;
      background-color: rgba(255,255,255,1.0);
      padding: 30px;
    }
    #download-panel .download-inner li {
      margin-left: 50px;
    }
    .center {
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="pagetitle">Annual timeseries</h1>

    <div class="row">
      <div class="four columns">
        <form onsubmit="return false;">
          <div class="row">
            <label for="frequency">Frequency</label>
            <select id="frequency" class="u-full-width">
              <option value="annual" >Annual</option>
              <option value="monthly">Monthly</option>
              <option value="seasonal" selected="selected">Seasonal</option>
            </select>
          </div>
          <div class="row">
            <label for="timeperiod">Time Period</label>
            <select id="timeperiod" class="u-full-width">
              <option value="2025" selected="selected">30 Years Centered on 2025</option>
              <option value="2050">30 Years Centered on 2050</option>
              <option value="2075">30 Years Centered on 2075</option>
            </select>
          </div>
          <div class="row">
            <label for="county">County</label>
            <!--
              The following select is merely for demonstration purposes -- it
              lets the user choose a county.  This select element just gives two
              county options, but the climate_widget_graph() function will work
              for any county fips code.  A list of all county fips codes is
              available for reference in the file 'fips_codes.csv'.
            -->
            <select id="county" class="u-full-width">
              <option value="37021" selected="selected">Buncombe County, NC</option>
              <option value="41003">Benton County, OR</option>
              <!--
              <option value="06071">San Bernadino County, CA</option>
              <option value="37089">Henderson County, NC</option>
              -->
            </select>
          </div>
          <div class="row">
            <label for="variable">Variable</label>
            <!--
              The following select is merely for demonstration purposes -- it
              lets the user choose a variable.  This select element just gives two
              variable options, but the climate_widget_graph() function will work
              with any of the 9 variable names listed in the comments
              at the top of the file climate-widget-graph.js.
            -->
            <select id="variable" class="u-full-width">
            </select>
          </div>
          <div class="row">
            <div class="six columns">
              <label for="scenario">Scenario</label>
              <select id="scenario" class="u-full-width">
                <option value="both">RCP 8.5 and 4.5</option>
                <option value="rcp85">RCP 8.5</option>
                <option value="rcp45" selected="selected">RCP 4.5</option>
              </select>
            </div>
            <div class="six columns">
              <label for="presentation">Presentation</label>
              <select id="presentation" class="u-full-width">
                <option value="absolute">Absolute</option>
                <option value="anomaly">Anomaly</option>
              </select>
            </div>
          </div>
          <!-- <button class="button-primary u-full-width" onclick="configureAndLaunchGraph()">Show Graph</button> -->
        </form>
      </div>
      <div class="eight columns">
        <!--
          The div the widget will be called on. Multiple of these could be
          declared (so that there are multiple graphs) at a time, or this
          DOM element could be generated programatically from JS.  Note that
          the size of the graph is determined by the size of this div, which
          in turn is specified in the '#widget' CSS rule above.
        -->
        <div id="widget"></div>
      </div>
    </div>
  </div>
 <div class="center"><button id="download-button">Download Data</button></div>
  <div id="download-panel" class="hidden">
    <div class="download-inner">
      <p>Use the following links to download this graph's data:</p>
      <ul></ul>
      <div class="center"><button id="download-dismiss-button">Dismiss</button></div>
    </div>
  </div>

  <!-- you must include jquery before including climate-widget-graph.js -->
  <script src="vendor/jquery.min.js"></script>
  <!--<script src="multigraph-nojq-min-5.1.1.js"></script>-->
  <script src="multigraph-nojq-min.js"></script>

  <!-- include climate-widget-graph.js before calling climate_widget_graph() -->
  <script src="climate-widget-graph.js"></script>

  <script type="text/javascript">
    //var unitsystem = "metric";
    var unitsystem = "english";

    var cwg = undefined;
    function cwgupdate(options) {
      if (cwg) {
        cwg.update(options);
      }
    }
    function configureAndLaunchGraph() {
      var selectedFrequency = $('#frequency').val();
      var selectedTimePeriod = $('#timeperiod').val();
      var selectedCounty = $('#county').val();
      var selectedVariable = $('#variable').val();
      var selectedScenario = $('#scenario').val();
      var selectedPresentation = $('#presentation').val();

      cwg = climate_widget_graph({
        'div'           :  "div#widget",         // jquery-style selector for the dom element that you want the graph to appear in
        //'dataprefix'    : 'data/02-final',
        'dataprefix'    : 'http://climate-widget-data.nemac.org/data',
        'font'          : 'Roboto',
        'unitsystem'    :  unitsystem,
        'frequency'     :  selectedFrequency,    // time frequency of graph to display ("annual", "monthly", or "seasonal")
        'timeperiod'    :  selectedTimePeriod,   // time period center for monthly/seasonal graphs ("2025", "2050", or "2075")
        'fips'          :  selectedCounty,       // 5-character fips code for county (as a string)
        'variable'      :  selectedVariable,     // name of variable to display; see climate-widget-graph.js for list of variables
        'scenario'      :  selectedScenario,     // name of scenario to display; both, rcp45, or rcp85
        'presentation'  :  selectedPresentation  // name of presentation; absolute or anomaly with respect to a baseline value
      });

    }
    $('#frequency').change(function() {
      var freq = $('#frequency').val();
      if (freq === "annual") {
          $('#pagetitle').text("Annual timeseries");
      }
      if (freq === "monthly") {
          $('#pagetitle').text("Monthly timeseries");
      }
      if (freq === "seasonal") {
          $('#pagetitle').text("Seasonal timeseries");
      }
      populate_variables($('#frequency').val());
      cwgupdate({
        frequency: freq,
        variable: $('#variable').val()
      });
  });
  $('#timeperiod').change(function() {
     cwgupdate({
       timeperiod: $('#timeperiod').val()
     });
  });
  $('#county').change(function() {
     cwgupdate({
       fips: $('#county').val()
     });
  });
  $('#variable').change(function() {
     cwgupdate({
       variable: $('#variable').val()
     });
  });
  $('#scenario').change(function() {
     cwgupdate({
       scenario: $('#scenario').val()
     });
  });
  $('#presentation').change(function() {
     cwgupdate({
       presentation: $('#presentation').val()
     });
  });

    function populate_variables(frequency) {
      var variables = climate_widget_variables(frequency);
      $("select#variable").empty();
      $(variables.map(function(v) {
            return ('<option value="' + v.id + '"'
                    + (v.selected ? ' selected="selected"' : '')
                    + '>'  + v.title[unitsystem] + '</option>');
        }).join("")).appendTo($("select#variable"));
    }

  $(document).ready(function() {
      populate_variables($('#frequency').val());

      WebFont.load({
        google: {
          families: ['Pacifico', 'Roboto']
        },
        active: function() {
          configureAndLaunchGraph();
        }
      });

    $('#download-button').click(function() {
      if (cwg) {
        var $ul = $('#download-panel').find('ul')
        $ul.empty();
        var dataurls = cwg.dataurls();
        if (dataurls.hist_obs) {
          $ul.append($("<li><a href='"+dataurls.hist_obs+"'>Observed Data</a></li>"));
        }
        if (dataurls.hist_mod) {
          $ul.append($("<li><a href='"+dataurls.hist_mod+"'>Historical Modeled Data</a></li>"));
        }
        if (dataurls.proj_mod) {
          $ul.append($("<li><a href='"+dataurls.proj_mod+"'>Projected Modeled Data</a></li>"));
        }
        $('#download-panel').removeClass("hidden");
      }
    });
    $('#download-dismiss-button').click(function() {
      $('#download-panel').addClass("hidden");
    });


  });

  </script>
</body>
</html>
